<!-- PERFIL COMPONENT HTML CORREGIDO -->

<div class="perfil-wrapper">
  <div class="perfil-card animate__animated animate__fadeInUp">

    <!-- ENCABEZADO -->
    <div class="encabezado-perfil d-flex align-items-center justify-content-between mb-4">
      <div class="d-flex align-items-center">
        <div>
          <h2 class="titulo-perfil">Bienvenido de nuevo</h2>
          <p class="sub-perfil">Aquí puedes ver y administrar tu cuenta</p>
        </div>
      </div>
    </div>

    <!-- DATOS PERSONALES -->
    <div class="datos-personales mb-4">
      <h5 class="mb-3"><i class="fas fa-user-circle me-2"></i>Datos del Usuario</h5>

      <div *ngIf="!modoEdicion">
        <ul class="datos-lista">
          <li><strong>Nombre:</strong> {{ nombre }}</li>
          <li><strong>Apellidos:</strong> {{ apellidos }}</li>
          <li><strong>Correo:</strong> {{ correo }}</li>
          <li><strong>CURP:</strong> {{ curp }}</li>
          <li><strong>Teléfono:</strong> {{ telefono }}</li>
          <li><strong>Fecha de Nacimiento:</strong> {{ fechaNacimiento }}</li>
        </ul>
        <button class="btn-editar" (click)="editarPerfil()"><i class="fas fa-edit me-2"></i>Editar Perfil</button>
      </div>

      <form *ngIf="modoEdicion" (ngSubmit)="guardarPerfil()" class="form-editar-perfil">
        <div class="mb-3">
          <label>Nombre</label>
          <input type="text" [(ngModel)]="nombre" name="nombre" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>Apellidos</label>
          <input type="text" [(ngModel)]="apellidos" name="apellidos" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>Correo</label>
          <input type="email" [(ngModel)]="correo" name="correo" class="form-control" disabled />
        </div>
        <div class="mb-3">
          <label>CURP</label>
          <input type="text" [(ngModel)]="curp" name="curp" class="form-control" disabled />
        </div>
        <div class="mb-3">
          <label>Teléfono</label>
          <input type="text" [(ngModel)]="telefono" name="telefono" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>Fecha de Nacimiento</label>
          <input type="text" [(ngModel)]="fechaNacimiento" name="fechaNacimiento" class="form-control" disabled />
        </div>

        <div class="d-flex gap-3">
          <button type="submit" class="btn btn-success"><i class="fas fa-save me-2"></i>Guardar</button>
          <button type="button" class="btn btn-secondary" (click)="cancelarEdicion()"><i class="fas fa-times me-2"></i>Cancelar</button>
        </div>
      </form>
    </div>

    <!-- SALDO + HISTORIAL + DEPÓSITO -->
    <div class="card-fila">

      <div class="tarjeta-saldo animate__animated animate__fadeInUp animate__delay-1s">
        <h5>Saldo disponible</h5>
        <p class="saldo-cantidad">{{ saldo | currency:'MXN':'symbol' }}</p>
        <small class="text-light">Actualizado el 24 April 2025, 03:45:41</small>
        <button class="btn-verde" (click)="abrirModal()">Ver movimientos</button>
      </div>

      <div class="historial-card animate__animated animate__fadeInUp animate__delay-2s">
        <h5 class="mb-3">Resumen de Movimientos</h5>
        <div class="historial-grid">
          <div class="historial-card" *ngIf="ultimoDeposito">
            <h6>Último Depósito</h6>
            <p>{{ ultimoDeposito.monto | currency:'MXN' }}</p>
            <small>{{ ultimoDeposito.fecha }}</small>
          </div>
          <div class="historial-card" *ngIf="ultimoRetiro">
            <h6>Último Retiro</h6>
            <p>{{ ultimoRetiro.monto | currency:'MXN' }}</p>
            <small>{{ ultimoRetiro.fecha }}</small>
          </div>
          <div class="historial-card">
            <h6>Apuestas Realizadas</h6>
            <p>{{ totalApuestas }}</p>
            <small>Este mes</small>
          </div>
        </div>
      </div>

      <div class="tarjeta-deposito">
        <h5>Mis Datos De Depósito</h5>
        <ul>
          <li><strong>Banco:</strong> BBVA</li>
          <li><strong>Cuenta:</strong> 0123 4567 8910 1112</li>
          <li><strong>CLABE:</strong> 012345678901234567</li>
          <li><strong>Beneficiario:</strong> Safe Capital Investment</li>
        </ul>
        <small>Envía tu comprobante al área de soporte para acreditar tu saldo.</small>
      </div>
    </div>

    <!-- SUBIR COMPROBANTE -->
    <div class="comprobante-box mb-5">
      <h5 class="mb-3"><i class="fas fa-upload me-2"></i>Subir comprobante de depósito</h5>
      <form (ngSubmit)="subirComprobante()" class="form-comprobante">
        <input type="file" class="form-control mb-3" (change)="onFileChange($event)" required />
        <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane me-2"></i>Enviar comprobante</button>
      </form>
    </div>

    <!-- MOVIMIENTOS RECIENTES -->
    <div class="movimientos-box">
      <h5 class="mb-3"><i class="fas fa-history me-2"></i>Movimientos recientes</h5>
      <div class="movimientos-recientes-grid">
        <div class="movimiento-card" *ngFor="let movimiento of movimientos"
             [ngClass]="{ 'deposito': movimiento.tipo === 'Depósito', 'retiro': movimiento.tipo === 'Retiro', 'apuesta': movimiento.tipo === 'Apuesta' }">
          <div class="icono-mov">
            <i [ngClass]="getIconoMovimiento(movimiento.tipo)"></i>
          </div>
          <div class="detalle-mov">
            <p class="tipo">{{ movimiento.tipo }}</p>
            <p class="monto">{{ movimiento.monto | currency:'MXN' }}</p>
            <p class="fecha">{{ movimiento.fecha }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- FORM RETIRO -->
    <div class="retiro-box animate__animated animate__fadeInUp animate__delay-3s">
      <h4>Solicitar retiro</h4>
      <form #retiroForm="ngForm" (ngSubmit)="solicitarRetiro()" class="formulario-retiro">
        <div>
          <label>Monto</label>
          <input
            type="number"
            [(ngModel)]="montoRetiro"
            name="montoRetiro"
            class="form-control"
            required
            min="1"
            #monto="ngModel"
          />
          <div class="texto-error" *ngIf="monto.invalid && monto.touched">
            El monto debe ser mayor a $0.00
          </div>
        </div>
    
        <div>
          <label>CLABE</label>
          <input
            type="text"
            [(ngModel)]="clabe"
            name="clabe"
            maxlength="18"
            minlength="18"
            pattern="\\d{18}"
            class="form-control"
            required
            #clabeInput="ngModel"
          />
          <div class="texto-error" *ngIf="clabeInput.invalid && clabeInput.touched">
            Ingresa una CLABE válida de 18 dígitos
          </div>
        </div>
    
        <div class="boton-retiro">
          <button [disabled]="retiroForm.invalid" type="submit" class="btn btn-success btn-retiro">
            <i class="fas fa-money-bill-wave me-2"></i>Solicitar retiro
          </button>
        </div>
      </form>
    </div>
    

    <!-- ACCIONES RÁPIDAS -->
    <div class="acciones-rapidas mt-4">
      <div class="accion-card" (click)="irAFondos()">
        <i class="fas fa-wallet"></i><span>Agregar Fondos</span>
      </div>
      <div class="accion-card" (click)="irAHistorial()">
        <i class="fas fa-clock"></i><span>Historial</span>
      </div>
      <div class="accion-card" (click)="irATrading()">
        <i class="fas fa-chart-line"></i><span>Ir a Trading</span>
      </div>
    </div>

  </div>
</div>

<!-- MODAL DE MOVIMIENTOS -->
<div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
  <div class="modal-movimientos animate__animated animate__fadeInUp" (click)="$event.stopPropagation()">
    <div class="modal-header d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0"><i class="fas fa-history me-2"></i>Historial Completo</h5>
      <button class="btn-close" (click)="cerrarModal()">&times;</button>
    </div>
    <div class="modal-body">
      <table class="tabla-movimientos w-100">
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Monto</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let movimiento of movimientos">
            <td>
              <i [ngClass]="getIconoMovimiento(movimiento.tipo)" class="me-2"></i>
              {{ movimiento.tipo }}
            </td>
            <td [ngClass]="{'positivo': movimiento.tipo === 'Depósito', 'negativo': movimiento.tipo === 'Retiro'}">
              {{ movimiento.monto | currency:'MXN' }}
            </td>
            <td>{{ movimiento.fecha }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
<!-- FOOTER -->
<footer class="footer-perfil mt-5">
  <p>© 2025 Safe Capital Investment. Todos los derechos reservados.</p>
</footer>
