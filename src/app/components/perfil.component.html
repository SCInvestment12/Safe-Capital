<!-- src/app/modules/profile/perfil.component.html -->
<div class="perfil-wrapper">
  <div class="perfil-card animate__animated animate__fadeInUp">

    <!-- ENCABEZADO -->
    <div class="encabezado-perfil mb-4" style="display: flex; justify-content: space-between; align-items: center;">
      <div>
        <h2 class="titulo-perfil">Bienvenido de nuevo</h2>
        <p class="sub-perfil">Aquí puedes ver y administrar tu cuenta</p>
      </div>
      <button class="btn-editar" style="white-space: nowrap;" (click)="irADashboard()">
        <i class="fas fa-arrow-left me-2"></i> Ir al Dashboard
      </button>
    </div>

    <!-- DATOS PERSONALES -->
    <div class="datos-personales mb-4">
      <h5 class="mb-3"><i class="fas fa-user-circle me-2"></i>Datos del Usuario</h5>
      <div *ngIf="!modoEdicion">
        <ul class="datos-lista">
          <li><strong>Nombre:</strong> {{ nombre }}</li>
          <li><strong>Apellidos:</strong> {{ apellidos }}</li>
          <li><strong>Correo:</strong> {{ correo }}</li>
          <li><strong>CURP:</strong> {{ curp }}</li>
          <li><strong>Teléfono:</strong> {{ telefono }}</li>
          <li><strong>Fecha de Nacimiento:</strong> {{ fechaNacimiento }}</li>
        </ul>
        <button class="btn-editar" (click)="editarPerfil()">
          <i class="fas fa-edit me-2"></i>Editar Perfil
        </button>
      </div>
      <form *ngIf="modoEdicion" (ngSubmit)="guardarPerfil()" class="form-editar-perfil">
        <div class="mb-3">
          <label>Nombre</label>
          <input type="text" [(ngModel)]="nombreEditado" name="nombre" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>Apellidos</label>
          <input type="text" [(ngModel)]="apellidosEditado" name="apellidos" class="form-control" required />
        </div>
        <div class="mb-3">
          <label>Teléfono</label>
          <input type="text" [(ngModel)]="telefonoEditado" name="telefono" class="form-control" required />
        </div>
        <div class="d-flex gap-3">
          <button type="submit" class="btn btn-success">
            <i class="fas fa-save me-2"></i>Guardar
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancelarEdicion()">
            <i class="fas fa-times me-2"></i>Cancelar
          </button>
        </div>
      </form>
    </div>

    <!-- SALDO + PORTAFOLIO + DATOS DE DEPÓSITO -->
    <div class="card-fila">

      <!-- TARJETA DE SALDO Y PORTAFOLIO -->
      <div class="tarjeta-saldo animate__animated animate__fadeInUp animate__delay-1s">
        <h5>Saldo disponible</h5>
        <p class="saldo-cantidad">{{ saldo | currency:'MXN':'symbol' }}</p>
        <small class="text-light">Actualizado: {{ ultimoDeposito?.fecha || ('-' ) }}</small>
        <button class="btn-verde" (click)="abrirModal()">Ver movimientos</button>

        <!-- PORTAFOLIO -->
        <div class="mt-4">
          <h6 class="mb-2 text-info"><i class="fas fa-briefcase me-2"></i>Mi portafolio</h6>
          <div *ngIf="portafolio.length > 0; else sinInversiones">
            <table class="tabla-movimientos w-100 text-white">
              <thead>
                <tr>
                  <th>Instrumento</th>
                  <th>Monto</th>
                  <th>Fecha</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of portafolio">
                  <td>{{ item.instrumento }}</td>
                  <td>{{ item.monto | currency:'MXN' }}</td>
                  <td>{{ item.fecha }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <ng-template #sinInversiones>
            <p class="text-light">No tienes inversiones en curso.</p>
          </ng-template>
        </div>
      </div>

      <!-- TARJETA DE DATOS DE DEPÓSITO -->
      <div class="tarjeta-deposito">
        <h5>Mis Datos De Depósito</h5>
        <ul>
          <li><strong>Banco:</strong> {{ banco }}</li>
          <li><strong>Cuenta:</strong> {{ cuenta }}</li>
          <li><strong>CLABE:</strong> {{ clabe }}</li>
          <li><strong>Beneficiario:</strong> {{ nombreCompleto }}</li>
          <li><strong>Referencia:</strong> {{ referencia }}</li>
        </ul>
        <small>Envía tu comprobante al área de soporte para acreditar tu saldo.</small>
      </div>
    </div>

    <!-- SUBIR COMPROBANTE -->
    <div class="comprobante-box mb-5">
      <h5 class="mb-3"><i class="fas fa-upload me-2"></i>Subir comprobante de depósito</h5>
      <form (ngSubmit)="subirComprobante()" class="form-comprobante">
        <input type="file" class="form-control mb-3" (change)="onFileChange($event)" required />
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-paper-plane me-2"></i>Enviar comprobante
        </button>
      </form>
    </div>

    <!-- MOVIMIENTOS RECIENTES -->
    <div class="movimientos-box mb-5">
      <h5 class="mb-3"><i class="fas fa-history me-2"></i>Movimientos recientes</h5>
      <div class="movimientos-recientes-grid">
        <div
          class="movimiento-card"
          *ngFor="let movimiento of movimientos"
          [ngClass]="{ 'deposito': movimiento.tipo === 'Depósito',
                       'retiro': movimiento.tipo === 'Retiro',
                       'inversion': movimiento.tipo === 'Inversion' }"
        >
          <div class="icono-mov">
            <i [ngClass]="getIconoMovimiento(movimiento.tipo)"></i>
          </div>
          <div class="detalle-mov">
            <p class="tipo">{{ movimiento.tipo }}</p>
            <p class="monto">{{ movimiento.monto | currency:'MXN' }}</p>
            <p class="fecha">{{ movimiento.fecha }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ACCIONES RÁPIDAS -->
    <div class="acciones-rapidas mt-4">
      <div class="accion-card" (click)="irAFondos()">
        <i class="fas fa-wallet"></i><span>Agregar Fondos</span>
      </div>
      <div class="accion-card" (click)="irATrading()">
        <i class="fas fa-chart-line"></i><span>Ir a Trading</span>
      </div>
    </div>

  </div>
</div>

<!-- MODAL DE MOVIMIENTOS -->
<div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
  <div class="modal-movimientos animate__animated animate__fadeInUp" (click)="$event.stopPropagation()">
    <div class="modal-header d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0"><i class="fas fa-history me-2"></i>Historial Completo</h5>
      <button class="btn-close" (click)="cerrarModal()">&times;</button>
    </div>
    <div class="modal-body">
      <table class="tabla-movimientos w-100">
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Monto</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let movimiento of movimientos">
            <td>
              <i [ngClass]="getIconoMovimiento(movimiento.tipo)" class="me-2"></i>
              {{ movimiento.tipo }}
            </td>
            <td [ngClass]="{'positivo': movimiento.tipo === 'Depósito','negativo': movimiento.tipo === 'Retiro'}">
              {{ movimiento.monto | currency:'MXN' }}
            </td>
            <td>{{ movimiento.fecha }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer class="footer-perfil mt-5">
  <p>© 2025 Safe Capital Investment. Todos los derechos reservados.</p>
</footer>
